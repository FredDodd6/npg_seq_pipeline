#!/usr/bin/env perl

use strict;
use warnings;
use Carp;
use Getopt::Long;
use FindBin qw($Bin);
use lib (-d "$Bin/../lib/perl5" ? "$Bin/../lib/perl5":"$Bin/../lib");
use npg_pipeline::product::heron::majora qw/ get_table_info_for_id_run
                                             get_majora_data
                                             json_to_structure
                                             update_metadata/;
use npg_tracking::Schema;
use WTSI::DNAP::Warehouse::Schema;

our $VERSION = '0';

my $id_run;
GetOptions 'id_run=i' => \$id_run, #numeric
or croak "Error in command line arguments\n";
if (!defined $id_run) {croak};

my $schema =npg_tracking::Schema->connect();
my $mlwh_schema=WTSI::DNAP::Warehouse::Schema->connect();

my ($fn,$rs) = get_table_info_for_id_run($id_run,$schema,$mlwh_schema);

my $json_string = get_majora_data($fn);

my %ds = json_to_structure($json_string,$fn);
my $ds_ref = \%ds;
update_metadata($rs,$ds_ref);



